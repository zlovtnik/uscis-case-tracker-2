# USCIS Case Tracker gRPC Server Configuration

# gRPC Server Settings
grpc {
  # Server host binding
  host = "0.0.0.0"
  host = ${?GRPC_HOST}
  
  # Server port
  port = 50051
  port = ${?GRPC_PORT}
}

# HTTP Health Check Server
# Provides /health, /ready, /live endpoints for cloud platform health probes
health {
  port = 8080
  port = ${?HEALTH_PORT}
  port = ${?PORT}  # Many platforms set PORT for the primary HTTP service
}

uscis {
  api {
    # USCIS Developer API - Case Status API v1.0.0
    # Documentation: https://developer.uscis.gov
    
    # Base URL for USCIS Case Status API
    # Sandbox: https://api-int.uscis.gov/case-status
    # Production: https://api.uscis.gov/case-status
    base-url = "https://api-int.uscis.gov/case-status"
    base-url = ${?USCIS_API_BASE_URL}
    
    # OAuth2 settings for USCIS Developer API
    oauth {
      # Access Token URL
      # Sandbox: https://api-int.uscis.gov/oauth/accesstoken
      token-url = "https://api-int.uscis.gov/oauth/accesstoken"
      token-url = ${?USCIS_OAUTH_TOKEN_URL}
      
      # Client credentials (obtain from developer.uscis.gov)
      client-id = ""
      client-id = ${?USCIS_CLIENT_ID}
      
      client-secret = ""
      client-secret = ${?USCIS_CLIENT_SECRET}
      
      # Grant type for OAuth2
      grant-type = "client_credentials"
      grant-type = ${?USCIS_OAUTH_GRANT_TYPE}
    }
    
    # Request timeout in seconds
    timeout = 30
    timeout = ${?USCIS_API_TIMEOUT_SECONDS}
    
    # Enable sandbox mode (uses mock responses if API credentials not configured)
    sandbox-mode = true
    sandbox-mode = ${?USCIS_SANDBOX_MODE}
    
    # Production rate limiting
    # Daily quota: 400,000 requests (resets at midnight EST)
    # Concurrency: 10 TPS (1 request every 100ms)
    rate-limit {
      requests-per-second = 10
      requests-per-second = ${?USCIS_RATE_LIMIT_RPS}
      min-request-interval-ms = 100
      min-request-interval-ms = ${?USCIS_RATE_LIMIT_INTERVAL_MS}
    }
  }
  
  # Data storage settings
  storage {
    # Storage type: "json" for file-based, "oracle" for Oracle database
    type = "json"
    type = ${?USCIS_STORAGE_TYPE}
    
    # Directory for storing case data (defaults to ~/.uscis-tracker) - used when type = "json"
    data-dir = ${user.home}"/.uscis-tracker"
    data-dir = ${?USCIS_DATA_DIR}
    
    # Filename for case history
    cases-file = "cases.json"
  }
  
  # Status check settings
  check {
    # Delay between batch status checks (in milliseconds)
    batch-delay = 1000
    batch-delay = ${?USCIS_BATCH_DELAY_MS}
    
    # Maximum retries on failure
    max-retries = 3
    max-retries = ${?USCIS_MAX_RETRIES}
    
    # Maximum concurrent requests for batch operations
    max-concurrency = 5
    max-concurrency = ${?USCIS_MAX_CONCURRENCY}
  }
}

# Oracle Database Configuration
# Supports wallet-based authentication for Oracle Autonomous Database
oracle {
  # JDBC URL for Oracle database
  # Standard format: jdbc:oracle:thin:@//hostname:port/servicename
  # Wallet format: jdbc:oracle:thin:@dbname_high?TNS_ADMIN=/path/to/wallet
  # ADB format: jdbc:oracle:thin:@(description=(address=(protocol=tcps)(host=...)(port=1522))(connect_data=(service_name=...)))
  jdbc-url = "jdbc:oracle:thin:@//localhost:1521/FREEPDB1"
  jdbc-url = ${?ORACLE_JDBC_URL}
  
  # Database username
  user = ""
  user = ${?ORACLE_USER}
  
  # Database password
  password = ""
  password = ${?ORACLE_PASSWORD}
  
  # Path to Oracle wallet directory (for Autonomous Database)
  # Contains: cwallet.sso, tnsnames.ora, sqlnet.ora, etc.
  wallet-path = ""
  wallet-path = ${?ORACLE_WALLET_PATH}
  
  # Wallet trust store and key store file names (relative to wallet-path)
  trust-store-file = "truststore.jks"
  trust-store-file = ${?ORACLE_TRUST_STORE_FILE}
  
  key-store-file = "keystore.jks"
  key-store-file = ${?ORACLE_KEY_STORE_FILE}
  
  # Connection pool settings
  pool-size = 10
  pool-size = ${?ORACLE_POOL_SIZE}
}
