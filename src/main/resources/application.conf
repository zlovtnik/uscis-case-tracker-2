# USCIS Case Tracker gRPC Server Configuration

# gRPC Server Settings
grpc {
  # Server host binding
  host = "0.0.0.0"
  host = ${?GRPC_HOST}
  
  # Server port
  port = 50051
  port = ${?GRPC_PORT}
}

uscis {
  api {
    # USCIS Developer API - Case Status API v1.0.0
    # Documentation: https://developer.uscis.gov
    
    # Base URL for USCIS Case Status API
    # Sandbox: https://api-int.uscis.gov/case-status
    # Production: https://api.uscis.gov/case-status
    base-url = "https://api-int.uscis.gov/case-status"
    base-url = ${?USCIS_API_BASE_URL}
    
    # OAuth2 settings for USCIS Developer API
    oauth {
      # Access Token URL
      # Sandbox: https://api-int.uscis.gov/oauth/accesstoken
      token-url = "https://api-int.uscis.gov/oauth/accesstoken"
      token-url = ${?USCIS_OAUTH_TOKEN_URL}
      
      # Client credentials (obtain from developer.uscis.gov)
      client-id = ""
      client-id = ${?USCIS_CLIENT_ID}
      
      client-secret = ""
      client-secret = ${?USCIS_CLIENT_SECRET}
      
      # Grant type for OAuth2
      grant-type = "client_credentials"
      grant-type = ${?USCIS_OAUTH_GRANT_TYPE}
    }
    
    # Request timeout in seconds
    timeout = 30
    timeout = ${?USCIS_API_TIMEOUT_SECONDS}
    
    # Enable sandbox mode (uses mock responses if API credentials not configured)
    sandbox-mode = true
    sandbox-mode = ${?USCIS_SANDBOX_MODE}
    
    # Production rate limiting
    # Daily quota: 400,000 requests (resets at midnight EST)
    # Concurrency: 10 TPS (1 request every 100ms)
    rate-limit {
      requests-per-second = 10
      requests-per-second = ${?USCIS_RATE_LIMIT_RPS}
      min-request-interval-ms = 100
      min-request-interval-ms = ${?USCIS_RATE_LIMIT_INTERVAL_MS}
    }
  }
  
  # Data storage settings
  storage {
    # Directory for storing case data (defaults to ~/.uscis-tracker)
    data-dir = ${user.home}"/.uscis-tracker"
    data-dir = ${?USCIS_DATA_DIR}
    
    # Filename for case history
    cases-file = "cases.json"
  }
  
  # Status check settings
  check {
    # Delay between batch status checks (in milliseconds)
    batch-delay = 1000
    batch-delay = ${?USCIS_BATCH_DELAY_MS}
    
    # Maximum retries on failure
    max-retries = 3
    max-retries = ${?USCIS_MAX_RETRIES}
    
    # Maximum concurrent requests for batch operations
    max-concurrency = 5
    max-concurrency = ${?USCIS_MAX_CONCURRENCY}
  }
}
